<!DOCTYPE html>
<meta charset="utf-8">
<style>

body {
  font: 10px sans-serif;
}

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.line {
  fill: none;
  stroke: steelblue;
  stroke-width: 1.5px;
}

</style>
<body>
<script src="d3.v3.js"></script>
<script src="jquery-2.1.3.min.js"></script>


<table>
  <tr>
    <td>
      <select id="cluster_sel">
        <option value=1>cluster 1</option>
        <option value=2>cluster 2</option>
        <option value=3>cluster 3</option>
        <option value=4>cluster 4</option>
        <option value=5>cluster 5</option>
      </select>
      <br/>
      <br/>
      Select a Longest Common Substring to highligh<br/>
      Male: &nbsp;&nbsp;&nbsp;&nbsp;<select id="cluster_lcs_male"></select> <br/>
      Female: <select id="cluster_lcs_female"></select>
    </td>
  </tr>
  <tr>
    <td>
      <div id="lcss_plot"></div>
    </td>
  </tr>
  <tr>
    <td>
      <div id="plot"></div>
    </td>
  </tr>
</table>

<script>
var margin = {top: 20, right: 80, bottom: 30, left: 50},
    width = 960 - margin.left - margin.right,
    height = 300 - margin.top - margin.bottom;

var x = d3.scale.linear()
    .range([0, width]);

var y = d3.scale.linear()
    .range([height, 0]);

var line = d3.svg.line()
    .interpolate("basis")
    .x(function(d) { return x(d.index); })
    .y(function(d) { return y(d.value); });

var raw_dict = {};

function AddPlot(cid) {
  var data_path = "data/c" + cid + ".txt";

  var color = d3.scale.category10();
  
  var xAxis = d3.svg.axis()
      .scale(x)
      .orient("bottom");
  
  var yAxis = d3.svg.axis()
      .scale(y)
      .orient("left");
  
  var svg = d3.select("#plot").append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .attr("id", "c" + cid)
    .append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
      
  d3.text(data_path, function(text) {
    var rows = d3.csv.parseRows(text),
        male = [], 
        female = [],
        raw_male = '',
        raw_female = '',
        data = [];
    for (var i=0, n = rows.length; i<n; i++) {
      var row = rows[i][0],
          v = row.split(" "),
          m = v[0],
          f = v[1];
      raw_male += m;
      raw_female += f;
      male.push({'index':i, 'value':parseInt(m)});
      female.push({'index':i, 'value':parseInt(f)});
    }
    
    raw_dict[cid] = {'male': raw_male, 'female': raw_female};
    data = [{'color':'blue', 'values':male},{'color':'red', 'values':female}];
    
    x.domain([0, n]);
    y.domain([0, 5]);
  
    svg.append("g")
        .attr("class", "x axis")
        .attr("transform", "translate(0," + height + ")")
        .call(xAxis)
      .append("text")
        .attr("x", width)
        .attr("y", -6)
        .style("text-anchor", "end")
        .text("Time Step");
  
    svg.append("g")
        .attr("class", "y axis")
        .call(yAxis)
      .append("text")
        .attr("transform", "rotate(-90)")
        .attr("y", 6)
        .attr("dy", ".71em")
        .style("text-anchor", "end")
        .text("Affect Rate");

    svg.append("text")
      .attr("class", "title")
      .attr("x", width/2)
      .attr("y", 0 - (margin.top / 2))
      .attr("text-anchor", "middle")
      .text(data_path);
  
    var mline = svg.selectAll(".male")
        .data(data)
      .enter().append("g")
        .attr("class", "male");
  
    mline.append("path")
        .attr("class", "line")
        .attr("d", function(d) { return line(d.values); })
        .style("stroke", function(d) { return d.color; });
        
  });
}

function plot_LCSS(nn, lcss_array, color, w) {
  var margin = { top: 20, right: 80, bottom: 30, left: 50 },
    width = w - margin.left - margin.right,
    height = 300 - margin.top - margin.bottom;

  var x = d3.scale.linear()
      .range([0, width]);

  var y = d3.scale.linear()
      .range([height, 0]);

  var line = d3.svg.line()
      .interpolate("basis")
      .x(function (d) { return x(d.index); })
      .y(function (d) { return y(d.value); });

  var n_lcss = lcss_array.length,
      n = 0,
      data = [];

  for (var i = 0; i < n_lcss; i++) {
    var lcss = lcss_array[i],
        m = lcss.length,
        values = [];
    for (var j = 0; j < m; j++) {
      values.push({ 'index': n+j, 'value': parseInt(lcss[j]) });
    }
    data.push({ 'color': color, 'values': values });
    n += m;
  }
  
  var xAxis = d3.svg.axis()
      .scale(x)
      .orient("bottom");

  var yAxis = d3.svg.axis()
      .scale(y)
      .orient("left");

  var svg = d3.select("#lcss_plot").append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .attr("id", "lcss")
    .append("g")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

  x.domain([0, n]);
  y.domain([0, 5]);

  svg.append("g")
      .attr("class", "y axis")
      .call(yAxis)
    .append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 6)
      .attr("dy", ".71em")
      .style("text-anchor", "end")
      .text("Affect Rate");

  svg.append("text")
    .attr("class", "title")
    .attr("x", width / 2)
    .attr("y", 0 - (margin.top / 2))
    .attr("text-anchor", "middle")
    .text("LCSS" + nn);

  var mline = svg.selectAll(".male")
      .data(data)
    .enter().append("g")
      .attr("class", "male");

  mline.append("path")
      .attr("class", "line")
      .attr("d", function (d) { return line(d.values); })
      .style("stroke", function (d) { return d.color; });
}

var clusters = [['203','212','217','225'],
                ['204','205','208','209','210','211','214','215','219','224'],
                ['206','207','218','220','222','228','230'],
                ['200','202','213'],
                ['201','221','223','226','227','229']];

var cluster_LCSS = [{'male':['4555555555555555555555555555','5555555555555555555555555554', '444555555555555555555555555',  '555555555555555555555555555',  '555555555555555555555555554',  '55555555555555555555555555', '55555555555555555555555554', '44555555555555555555555555', '44455555555555555555555555', '22222222222222222222222111', '4455555555555555555555555', '4555555555555555555555555', '5555555555555555555555554', '2222222222222222222222111', '5555555555555555555555555', '222222222222222222222111', '455555555555555555555555', '444555555555555555555555', '555555555555555555555554', '555555555555555555555555', '55555555555555555555555', '22222222222222222222111', '44555555555555555555555', '55555555555555555555554', '22222222222222222222222', '4444555555555555555555', '2222222222222222222111', '4555555555555555555555', '2222222222222222222222', '2222222222221111111111', '5555555555555555555555', '5555555555555555555554', '222222222221111111111', '444455555555555555555', '222222222211111111111', '222222222222222222222', '555555555555555555554', '222222222222222222111', '444555555555555555555', '555555555555555555555', '55555555555555555554', '22222222222222222111', '55555555555555555555', '44555555555555555555', '22222222222222222222', '22222222221111111111', '22222222211111111111', '44455555555555555555', '2222222222222222222', '4555555555555555555', '2222222222222222111', '4455555555555555555', '2222222221111111111', '5555555555555555555', '5555555555555555554', '2222222211111111111', '455555555555555555', '222222221111111111', '222222222222222111', '555555555555555555', '555555555555555554', '222222211111111111', '222222222222222222', '444444444444444444', '22222211111111111', '32222222222222222', '55555555555555555', '55555555555555554', '22222222222222111', '22222221111111111', '44444444444444444', '22222222222222222', '5555555555555554', '2222222222222111', '2222222222222222', '4444444444444444', '2222222222111111', '2222222222221111', '5555555555555555', '2222221111111111', '2222211111111111', '3222222222222222', '222222222222222', '222221111111111', '222222222111111', '555555555555554', '222222222221111', '222222222222221', '555555555555555', '444444444444444', '222211111111111', '222222222222111', '22222222222111', '22221111111111', '33332222222222', '22222222222221', '22222222222222', '22222222222211', '22222222221111', '55555555555555', '55555555555554', '32222222222222', '44444444444444', '22211111111111', '22222222111111', '3332222222222', '2211111111111', '2222222222211', '4444444444444', '2222222222111', '2221111111111', '3222222222222', '2222222111111', '5555555555555', '2222222221111', '2222222222221', '2222222222222', '3444444444444', '2222221111111', '5555555555554', '332222222222', '222222222211', '222222222222', '222222222221', '444444444444', '222222221111', '222111111111', '111111111112', '222222222111', '222221111111', '221111111111', '222222111111', '444455555555', '344444444444', '555555555554', '555555555555', '211111111111', '322222222222', '22222222111', '55555555555', '33332222222', '21111111111', '33222222222', '44444444444', '22111111111', '22222222221', '22222221111', '22222222222', '22222111111', '22221111111', '44455555555', '22222222211', '11111111111', '11111111112', '32222222222', '55555555554', '2221111111', '1111111112', '2222221111', '4455555555', '2222222211', '4444444444', '5555555555', '3222222222', '3444444444', '1111111111', '5555555554'], 'female': ['111111111111111111111111111112222','11111111111111111111111111112222','1111111111111111111111111112222','1111111111111111111111111111122','4444444444444444444444444444444','2222222222222222222222222222222','111111111111111111111111111122','111111111111111111111111112222','444444444444444444444444444444','211111111111111111111111111111','222222222222222222222222222222','44444444444444444444444444444','22222222222222222222222222222','11111111111111111111111111122','11111111111111111111111111111','11111111111111111111111112222','1111111111111111111111111111','2222222222222222222222222222','3444444444444444444444444444','4444444444444444444444444444','1111111111111111111111111122','1111111111111111111111112222','2111111111111111111111111111','222222222222222222222222222','111111111111111111111111122','444444444444444444444444444','111111111111111111111111111','111111111111111111111112222','44444444444444444444444444','11111111111111111111111111','11111111111111111111112222','33333333333333333333333333','22222222222222222222222222','11111111111111111111111122','4444444444444444444444444','1111111111111111111111122','1111111111111111111111111','2222222222222222222222222','3333333333333333333333333','1111111111111111111112222','111111111111111111111122','111111111111111111112222','444444444444444444444444','222222222222222222222222','333333333333333333333333','111111111111111111111111','33333333333333333333333','44444444444444444444444','11111111111111111111122','11111111111111111111111','22222222222222222222222','11111111111111111112222','1111111111111111112222','4444444444444444444444','3333333333333333333333','2222222222222222222222','1111111111111111111111','2111111111111111111111','1111111111111111111122','222222222222222222222','111111111111111111122','444444444444444444444','111111111111111111111','333333333333333333333','111111111111111112222','44444444444444444444','22222222222222222222','21111111111111111111','33333333333333333333','11111111111111111111','11111111111111111112','11111111111111111122','32222222222222222222','11111111111111112222','1111111111111111111','1111111111111111112','1111111111111112222','2222222222222222222','4444444444444444444','2111111111111111111','3333333333333333333','1111111111111111122','322222222222222222','444444444444444444','111111111111112222','333333333333333333','222222222222222222','344444444444444444','444455555555555555','111111111111111111','111111111111111112','211111111111111111','111111111111111122','11111111111111122','44455555555555555','22222222222222222','11111111111111111','33333333333333333','11111111111111112','44444444444444444','11111111111112222','44445555555555555','4444444444444444','4455555555555555','2111111111111111','4445555555555555','3333333333333333','1111111111111112','1111111111112222','2222222222222222','1111111111111122','1111111111111111','5555555555544444','111111111111111','111111111111112','222222222222222','444444444444444','111111111112222','555555555555554','111111111111222','455555555555555','445555555555555','333333333333333','555555555555544','111111111111122','555555555544444','11111111112222','33333333333333','55555555555555','55555555555554','55555555544444','11111111111112','44445555555555','21111111111111','11111111111111','45555555555555','55555555555544','22222222222222','11111111111122','44444444444444','11111111111222','2222222222222','3333333333333','1111111111222','1111111111122','2111111111111','5555555555555','5555555555554','1111111112222','5555555544444','3444444444444','1111111111111','1111111111112','4445555555555','5555555555544','4444444444444','555555544444','111111111222','334444444444','211111111111','322222222222','555555555544','555555555555','555555555554','222234444444','111111111111','111111111112','445555555555','111111111122','111111112222','222222222222','444444444444','333333333333','11111112222','11111111122','33333333333','22234444444','11111111111','44455555555','55555544444','45555555555','11111111112','55555555555','55555555554','22222222222','34444444444','32222222222','44444444443','44444444444','11111111222','55555555544','3333333333','4444444444','4444555555','1111111122','1111111222','1111112222','4455555555','5555555544','5555544444','3222222222','2234444444','5555555555','5555555554','4444444443','1111111111','1111111112','3344444444','2222222222','2222222223']}, 
{'male': ['222223333','444444433','22222333','44444443','22223333','44444433','2222333','3334444','3322222','4444444','2222233','4444433','3332222','2223333','4444443','444333','222233','223333','444433','222333','333222','333444','222222','332222','222223','334444','322222','444443','443333','444444','44333','33344','22233','43333','33322','34444','44444','23333','32222','44443','33334','22223','33444','44433','22222','33222','22333'], 'female':['44444444444444444444444444','34444444444444444444444444','4444444444444444444444444','444444444444444444444444','44444444444444444444444','4444444444444444444444','3444444444444444444444','444444444444444444444','44444444444444444444','34444444444444444444','3444444444444444444','4444444444444444444','322222222222222222','444444444444444444','34444444444444444','32222222222222222','22222222222222222','33333333333333333','44444444444444444','3444444444444444','2222222222222222','3333333333333333','3333333333333334','3222222222222222','4444444444444444','333333333333334','333333333333333','222222222222222','344444444444444','444444444444444','322222222222222','33333333333333','33333333333334','44444444444444','22222222222222','32222222222222','34444444444444','3222222222222','3333333333333','3333333333334','2222222222222','4444444444444','3444444444444','222222222222','444444444444','333333333333','333333333334','344444444444','322222222222','44444444444','22222222222','33333333334','33333333333','34444444444','33333222222','32222222222','3333222222','3333333333','3333333334','4444444444','3222222222','3444444444','3333322222','2222222222']},
{'male': ['55555555555555444444444','5555555555555444444444','555555555555444444444','555555555555554444444','55555555555554444444','55555555555444444444','5555555555444444444','3333444444444444444','5555555555554444444','5555555555555544444','333344444444444444','555555555554444444','333444444444444444','555555555555554444','555555555444444444','555555555555544444','55555555555544444','55555555444444444','55555555555554444','55555555554444444','33344444444444444','44455555555555555','33334444444444444','33444444444444444','55555555555555444','5555555555555544','3344444444444444','4455555555555555','5555555555555444','5555555555554444','3444444444444444','5555555555544444','5555555444444444','5555555554444444','3334444444444444','3222222222222222','555555554444444','555555555555554','334444444444444','555555555554444','555555555544444','444444444444444','555555444444444','555555555555544','222222222222222','222222222233333','555555555555444','344444444444444','455555555555555','333344444444444','322222222222222','55555554444444','45555555555555','22222222222222','55555555555444','55555555555544','55555555555554','32222222222222','22222222223333','55555555555555','44444444444444','55555555544444','22222222233333','55555555554444','44455555555555','55555444444444','33344444444444','34444444444444','5555444444444','3344444444444','4444444444444','3222222222222','2222222233333','5555555555555','5555554444444','5555555555544','5555555555444','2222222222222','5555555554444','5555555544444','4455555555555','5555555555554','4445555555555','2222222223333','222222222233','555444444444','555555555444','333444444444','222222222222','555555554444','444444444444','222222233333','555555444444','222222223333','555555544444','555554444444','344444444444','322222222222','555555555555','445555555555','455555555555','555555555544','555555555554','33444444444','55555554444','55555555555','44455555555','44444444445','44444444444','45555555555','55444444444','55555544444','22222233333','22222222223','33344444444','22222222233','55554444444','55555444444','22222222222','55555555544','55555555444','22222223333','32222222222','44444455555','55555555554','2222233333','5555554444','4444445555','5444444444','3333444444','5555555544','5555555555','5555555554','4444444444','4444444445','4455555555','3444444444','2222222233','5554444444','4445555555','5555544444','4444455555','2222223333','5555444444','3344444444','5555555444','2222222222','2222222223',], 'female':['5555555555555555555555555555555555555555555555','555555555555555555555555555555555555555555555','55555555555555555555555555555555555555555555','5555555555555555555555555555555555555555555','555555555555555555555555555555555555555555','55555555555555555555555555555555555555555','5555555555555555555555555555555555555555','555555555555555555555555555555555555555','55555555555555555555555555555555555555','5555555555555555555555555555555555555','555555555555555555555555555555555555','55555555555555555555555555555555555','5555555555555555555555555555555555','555555555555555555555555555555555','55555555555555555555555555555555','5555555555555555555555555555555','555555555555555555555555555555','55555555555555555555555555555','5555555555555555555555555555','555555555555555555555555555','55555555555555555555555555','5555555555555555555555555','555555555555555555555555','55555555555555555555555','5555555555555555555555','444555555555555555555','555555555555555555555','55555555555555555555','44455555555555555555','44555555555555555555','4445555555555555555','5555555555555555555','4555555555555555555','4455555555555555555','455555555555555555','445555555555555555','444444444555555555','555555555555555555','44444444555555555','55555555555555555','45555555555555555','4444444555555555','5555555555555555','4445555555555555','445555555555555','444444555555555','444444444555555','555555555555555','44444555555555','44444444445555','44444444555555','55555555555555','45555555555555','44444444444444','4444444555555','4445555555555','4444444445555','5555555555555','4444444444444','4444555555555','4555555555555','444444444455','444444444444','444555555555','555555555555','444444555555','445555555555','444444445555','55555555555','44444555555','44555555555','44444444444','45555555555','44444444455','44444445555','4444445555','5555555555','4444444444','4555555555','4444555555','4444444455',]}, 
{'male': ['22211111111111111111111111111111111111111111111111111111','2211111111111111111111111111111111111111111111111111111','1111111111111111111111111111111111111111111111111111122','211111111111111111111111111111111111111111111111111111','111111111111111111111111111111111111111111111111111122','11111111111111111111111111111111111111111111111111122','21111111111111111111111111111111111111111111111111111','11111111111111111111111111111111111111111111111111111','1111111111111111111111111111111111111111111111111111','1111111111111111111111111111111111111111111111111122','111111111111111111111111111111111111111111111111111','111111111111111111111111111111111111111111111111122','22211111111111111111111111111111111111111111111111','11111111111111111111111111111111111111111111111111','11111111111111111111111111111111111111111111111122','2211111111111111111111111111111111111111111111111','1111111111111111111111111111111111111111111111111','1111111111111111111111111111111111111111111111122','111111111111111111111111111111111111111111111111','111111111111111111111111111111111111111111111112','211111111111111111111111111111111111111111111111','111111111111111111111111111111111111111111111122','11111111111111111111111111111111111111111111122','11111111111111111111111111111111111111111111111','11111111111111111111111111111111111111111111112','2221111111111111111111111111111111111111111111','1111111111111111111111111111111111111111111111','1111111111111111111111111111111111111111111112','1111111111111111111111111111111111111111111122','111111111111111111111111111111111111111111111','111111111111111111111111111111111111111111112','221111111111111111111111111111111111111111111','111111111111111111111111111111111111111111122','11111111111111111111111111111111111111111122','21111111111111111111111111111111111111111111','11111111111111111111111111111111111111111111','11111111111111111111111111111111111111111112','1111111111111111111111111111111111111111112','1111111111111111111111111111111111111111122','1111111111111111111111111111111111111111111','111111111111111111111111111111111111111111','111111111111111111111111111111111111111112','111111111111111111111111111111111111111122','11111111111111111111111111111111111111111','11111111111111111111111111111111111111112','11111111111111111111111111111111111111122','1111111111111111111111111111111111111111','1111111111111111111111111111111111111112','1111111111111111111111111111111111111122','111111111111111111111111111111111111111','111111111111111111111111111111111111112','111111111111111111111111111111111111122','11111111111111111111111111111111111111','11111111111111111111111111111111111112','11111111111111111111111111111111111122','1111111111111111111111111111111111112','1111111111111111111111111111111111111','1111111111111111111111111111111111122','111111111111111111111111111111111122','111111111111111111111111111111111111','111111111111111111111111111111111112','11111111111111111111111111111111122','11111111111111111111111111111111111','11111111111111111111111111111111112','2221111111111111111111111111111111','1111111111111111111111111111111111','1111111111111111111111111111111112','1111111111111111111111111111111122','111111111111111111111111111111122','222111111111111111111111111111111','221111111111111111111111111111111','111111111111111111111111111111111','111111111111111111111111111111112','22211111111111111111111111111111','11111111111111111111111111111111','11111111111111111111111111111112','22111111111111111111111111111111','21111111111111111111111111111111','11111111111111111111111111111122','2111111111111111111111111111111','1111111111111111111111111111122','1111111111111111111111111111111','1111111111111111111111111111112','2211111111111111111111111111111','222111111111111111111111111111','111111111111111111111111111111','211111111111111111111111111111','111111111111111111111111111122','111111111111111111111111111112','11111111111111111111111111122','22211111111111111111111111111','11111111111111111111111111111','11111111111111111111111111112','22111111111111111111111111111','1111111111111111111111111122','1111111111111111111111111112','1111111111111111111111111111','2111111111111111111111111111','2211111111111111111111111111','211111111111111111111111111','111111111111111111111111122','111111111111111111111111111','111111111111111111111111112','11111111111111111111111111','11111111111111111111111112','11111111111111111111111122','1111111111111111111111111','1111111111111111111111112','1111111111111111111111122','111111111111111111111122','111111111111111111111111','111111111111111111111112','211111111111111111111111','222111111111111111111111','11111111111111111111122','11111111111111111111111','11111111111111111111112','22111111111111111111111','1111111111111111111122','2111111111111111111111','1111111111111111111111','1111111111111111111112','111111111111111111111','111111111111111111112','222111111111111111111','111111111111111111122','11111111111111111112','11111111111111111122','22111111111111111111','11111111111111111111','1111111111111111122','2111111111111111111','1111111111111111111','1111111111111111112','2221111111111111111','111111111111111112','111111111111111111','221111111111111111','111111111111111122','11111111111111122','11111111111111112','21111111111111111','22211111111111111','11111111111111111','1111111111111122','2211111111111111','1111111111111111','1111111111111112','211111111111111','111111111111111','111111111111112','111111111111122','11111111111111','11111111111112','22211111111111','11111111111122','1111111111122','3333333333333','2211111111111','1111111111111','1111111111112','111111111122','333333333333','111111111111','111111111112','211111111111','11111111122','33333333333','11111111111','11111111112','1111111111','1111111112','3333333333','1111111122',], 'female':['2222222222222222222222222222222222222222221111111111111','222222222222222222222222222222222222222221111111111111','22222222222222222222222222222222222222221111111111111','2222222222222222222222222222222222222221111111111111','222222222222222222222222222222222222221111111111111','22222222222222222222222222222222222221111111111111','2222222222222222222222222222222222221111111111111','222222222222222222222222222222222221111111111111','22222222222222222222222222222222221111111111111','2222222222222222222222222222222221111111111111','2222222222222222222222222222222222222222222221','222222222222222222222222222222221111111111111','222222222222222222222222222222222222222222221','222222222222222222222222222222222222222222222','22222222222222222222222222222222222222222222','22222222222222222222222222222222222222222221','22222222222222222222222222222221111111111111','2222222222222222222222222222222222222222222','2222222222222222222222222222222222222222221','2222222222222222222222222222221111111111111','222222222222222222222222222222222222222221','222222222222222222222222222222222222222222','222222222222222222222222222221111111111111','22222222222222222222222222221111111111111','22222222222222222222222222222222222222221','22222222222222222222222222222222222222222','2222222222222222222222222222222222222222','2222222222222222222222222222222222222221','3333333333333333333333333333333333333333','2222222222222222222222222221111111111111','222222222222222222222222222222222222222','222222222222222222222222222222222222221','333333333333333333333333333333333333333','222222222222222222222222221111111111111','22222222222222222222222222222222222221','22222222222222222222222222222222222222','33333333333333333333333333333333333333','22222222222222222222222221111111111111','2222222222222222222222222222222222221','2222222222222222222222222222222222222','3333333333333333333333333333333333333','2222222222222222222222221111111111111','222222222222222222222221111111111111','222222222222222222222222222222222222','222222222222222222222222222222222221','333333333333333333333333333333333333','22222222222222222222221111111111111','22222222222222222222222222222222222','22222222222222222222222222222222221','33333333333333333333333333333333333','3333333333333333333333333333333333','2222222222222222222222222222222221','2222222222222222222222222222222222','2222222222222222222221111111111111','222222222222222222222222222222221','222222222222222222222222222222222','222222222222222222221111111111111','333333333333333333333333333333333','22222222222222222222222222222222','22222222222222222222222222222221','33333333333333333333333333333333','22222222222222222222222211111111','22222222222222222221111111111111','2222222222222222221111111111111','3333333333333333333333333333333','1111111222222222222222222222222','2222222222222222222222222222222','2222222222222222222222222222221','2222222222222222222222211111111','222222222222222221111111111111','222222222222222222222222222233','111111222222222222222222222222','333333333333333333333333333333','222222222222222222222211111111','222222222222222222222222222221','222222222222222222222222222222','22222222222222222222211111111','11111222222222222222222222222','22222222222222221111111111111','22222222222222222222222222221','22222222222222222222222222222','12222222222222222222222222222','33333333333333333333333333333','22222222222222222222222222233','22222222222222222222222222111','1111111111111222222222222222','2222222222222222222222222222','2222222222222222222222222221','3333333333333333333333333333','1111222222222222222222222222','2222222222222222222222222233','2222222222222222222222222111','2222222222222222222211111111','2222222222222221111111111111','1111112222222222222222222222','222222222222222222222222222','222222222222222222222222221','122222222222222222222222222','111222222222222222222222222','222222222222222222222222233','333333333333333333333333333','222222222222221111111111111','222222222222222222211111111','222222222222222222222222111','111111111111222222222222222','111112222222222222222222222','22222222222222222211111111','22222222222222222222222111','22222222222222222222222233','11222222222222222222222222','22222222222221111111111111','11112222222222222222222222','33333333333333333333333333','22222222222222222222222221','22222222222222222222222222','11111111111222222222222222','1222222222222222222222222','2222222222222222222222111','2222222222222222211111111','1112222222222222222222222','2222222222222222222222221','2222222222222222222222222','3333333333333333333333333','1111111111222222222222222','2222222222222222222222233','2222222222221111111111111','222222222222222211111111','222222222222222222222222','222222222222222222222221','112222222222222222222222','111111111222222222222222','222222222222222222222111','222222222222222222222233','333333333333333333333333','222222222221111111111111','11111111222222222222222','22222222221111111111111','12222222222222222222222','22222222222222211111111','22222222222222222222222','22222222222222222222221','22222222222222222222111','33333333333333333333333','22222222222222222222233','3333333322222222222222','3333333333333333333333','2222222221111111111111','2222222222222222222221','2222222222222222222222','2222222222222222222111','2222222222222222222233','2222222222222211111111','1111111222222222222222','222222222222222222111','333333322222222222222','111111111111122222222','222222222222222222221','222222222222222222222','222222222222221111111','222222221111111111111','111111222222222222222','222222222222211111111','222222222222222222233','333333333333333333333','22222222222222222222','22222222222222222221','11111222222222222222','33333322222222222222','11111111111122222222','22222222222222222111','22222222222221111111','22222222222211111111','22222222222222222233','33333333333333333333','11111111111112222222','22222221111111111111','1111111111122222222','3333333333333333333','2222222222222222111','1111111111112222222','2222221111111111111','1111222222222222222','3333322222222222222','2222222222222222222','2222222222222222221','2222222222221111111','2222222222211111111','2222222222222222233','333322222222222222','322222222222222222','111111111122222222','333333333333333333','222222222221111111','222222222222222221','222222222222222222','222221111111111111','222222222211111111','222222222222222111','111111111112222222','222222222222222233','111222222222222222','22222222222222111','11111111112222222','33322222222222222','22222222222222221','22222222222222222','33333333333333333','11222222222222222','22222222222222233','22222222221111111','11111111122222222','22222222211111111','22221111111111111','2222222222222111','1111111122222222','1111111112222222','2222222222222233','2222222221111111','1111111111111222','3322222222222222','2221111111111111','1222222222222222','2222222222222222','2222222222222221','2222222211111111','3333333333333333','222222211111111','221111111111111','222222222222222','222222222222221','111111122222222','111111111111222','222222222222233','222222221111111','322222222222222','111111112222222','333333333333333','222222222222111','22222222222111','33333333333333','22222222222233','11111122222222','22222211111111','11111112222222','22222221111111','21111111111111','22222222222221','22222222222222','11111111111222','1111122222222','1111112222222','2222222222221','2222222222222','3333333333333','2222222222233','1111111111222','2222211111111','1111111111111','2222222222111','2222221111111','222222222233','222221111111','111111111222','222211111111','111112222222','111122222222','333222222222','111111111111','222222222111','222222222222','222222222221','333333333333','22211111111','33333333333','22222222111','11112222222','22221111111','11122222222','11111111111','33222222222','22222222222','22222222221','11111111222','22222222233','3333333333','2211111111','1122222222','1111111222','2222222111','2221111111','3222222222','2222222233','2222222211','1111111111','1112222222','2222222221','2222222222']},
{'male': ['333333333334444444444','433333333333333333333','33333333333333333333','43333333333333333333','44443333333333333333','33333333334444444444','4443333333333333333','4333333333333333333','3333333333333333333','3333333334444444444','333333333334444444','333333333333333333','443333333333333333','333333334444444444','433333333333333333','33333334444444444','33333333444444444','33333333334444444','43333333333333333','33333333333333333','4444333333333333','3333333333333333','4433333333333333','3333333333344444','3333333444444444','3333333334444444','3333334444444444','333333333334444','333333333344444','333333333333333','333334444444444','444333333333333','333333444444444','444444433333333','433333333333333','333333334444444','44333333333333','33333333333334','44433333333333','44444444443333','44443333333333','33333334444444','33333333333444','33333333344444','33333444444444','33334444444444','44444433333333','33333333333333','33333333334444','4444433333333','3333333333344','3333333333333','3333333333334','4433333333333','4444444333333','3333334444444','4444444444333','4333333333333','3333333334444','3333333344444','4444333333333','3334444444444','4443333333333','4444444443333','3333333333444','4444443333333','3333444444444','443333333333','333334444444','444444444433','433333333333','444443333333','444444433333','333444444444','334444444444','333333333333','333333333334','333333333444','333344444444','333333334444','444433333333','333333444444','444333333333','444444444333','444444333333','333333344444','444444443333','333333333344','33444444444','43333333333','33333444444','44444444433','44444443333','44444433333','44444444333','33334444444','44444444443','44444333333','44433333333','44443333333','44333333333','33344444444','33333344444','33333333334','33333333333','34444444444','33333333444','33333334444','33333333344','4444444333','3333333333','3333333334','4444443333','4444333333','3333444444','3333333344','4444444433','4443333333','4444433333','4444444443','3333333444','4444444444','3334444444','3444444444','3344444444','4333333333','4433333333','3333334444','3333344444',], 'female':['444444444444444444','44444444444444444','4444444444444444','444444444444444','44444444444444','4444444444444','444444444444','44444444444','4444444444','444444444','44444444','3444444','4444444','4444443','344444','334444','444443','444444',]},
                   ];

function AddLCSSPlot(idx,w) {
  var lcss = cluster_LCSS[idx];
  var male_lcss = lcss["male"],
      female_lcss = lcss["female"];
  plot_LCSS(idx, male_lcss, 'blue', w);
  plot_LCSS(idx, female_lcss, 'red', w);
}

function AddClusterPlot(cidx) {
  var clst = clusters[cidx];
  for (var i=0,n=clst.length;i<n;i++) {
    AddPlot(clst[i]);
  }
}

function AddLCSSOptions(cidx) {
  var lcss_set = cluster_LCSS[cidx];
  $('#cluster_lcs_male').find('option').remove().end().append('<option></option>');
  $('#cluster_lcs_female').find('option').remove().end().append('<option></option>');
  for (var k in lcss_set) {
    var lcss_data = lcss_set[k];
    for (var i=0,n=lcss_data.length;i<n;i++) {
      $('#cluster_lcs_' + k).append('<option value="'+lcss_data[i]+'">'+lcss_data[i]+'</option>');
    }
  }
}

var select_cid=0;

function highlighLCS() {
  var male_lcs = $( "#cluster_lcs_male option:selected" ).val(),
      female_lcs = $( "#cluster_lcs_female option:selected" ).val();

  d3.selectAll('.line')
      .transition()
      .style('opacity',0.2);

  var couples = clusters[select_cid],
      n = couples.length;

  var data_dict =  {};

  d3.selectAll(".hline").remove();

  for (var i=0;i < n; i++ ) {
    var cid = couples[i],
        data = [],
        raw_data = raw_dict[cid],
        raw_male = raw_data.male,
        raw_female = raw_data.male;

    if (male_lcs && male_lcs.length>0) {
      var raw_select = raw_male,
          start = 0;
      
      while (start >=0) {
        start = raw_male.indexOf(male_lcs, start);
        if (start >=0) {
          var values = [];
          for (var j=0, m=male_lcs.length;j<m;j++) { 
            values.push({'index':j+start, 'value':parseInt(male_lcs[j])});
          }
          data.push({'color':'blue', 'values':values});
          start += 1;
        }
      }
    }
    if (female_lcs && female_lcs.length>0) {
      var raw_select = raw_female,
          start = 0;
      
      while (start >=0) {
        start = raw_male.indexOf(female_lcs, start);
        if (start >=0) {
          var values = [];
          for (var j=0, m=female_lcs.length;j<m;j++) { 
            values.push({'index':j+start, 'value':parseInt(female_lcs[j])});
          }
          data.push({'color':'red', 'values':values});
          start += 1;
        }
      }
    }
    data_dict[cid] = data;
  }

  for (var i=0;i < n; i++ ) {
    var cid = couples[i],
        svg = d3.select("#c" + cid + " g");

    var hline = svg.selectAll(".hline")
        .data(data_dict[cid])
      .enter().append("g")
        .attr("class", "hline");

    hline.append("path")
        .attr("class", "line")
        .attr("d", function(d) { return line(d.values); })
        .style("stroke", function(d) { return d.color; });
  }
}

$('document').ready(function(){
  AddClusterPlot(0);
  AddLCSSOptions(0);
  AddLCSSPlot(0, 960);
  AddLCSSPlot(1, 960);
  AddLCSSPlot(2, 960);
  AddLCSSPlot(3, 960);
  AddLCSSPlot(4, 960);

  AddLCSSPlot(0, 2000);
  AddLCSSPlot(1, 2000);
  AddLCSSPlot(2, 2000);
  AddLCSSPlot(3, 2000);
  AddLCSSPlot(4, 2000);

  $('#cluster_sel').change(function(){
    $( "#cluster_sel option:selected" ).each(function() {
      var sel = parseInt($( this ).val());
      select_cid = sel -1;
      $('#plot').empty();
      AddClusterPlot(select_cid);
      AddLCSSOptions(select_cid);
    });
  });

  $('#cluster_lcs_male').change(function(){
    highlighLCS();
  });
  $('#cluster_lcs_female').change(function(){
    highlighLCS();
  });
});
</script>
